# LangConnect API Documentation

## Health Check

- **URL**: `/health`
- **Method**: GET
- **Description**: Basic health check endpoint to confirm the API is operational. Used for monitoring and load balancer health checks.
- **Response**:
  - Status: 200 OK
  - Body: `{"status": "ok"}`
- **Technical Notes**: Not dependent on other system components; doesn't use database or document store.

## Collections

### Create Collection

- **URL**: `/collections`
- **Method**: POST
- **Description**: Creates a new vector collection in the PostgreSQL database to store and organize document embeddings.
- **Implementation Details**:
  - Creates a record in the collections table with name and description
  - Doesn't initialize the vector collection in PGVector until documents are added
  - Collection has UUID primary key generated by PostgreSQL
- **Request Body**: 
  - `name`: string (required) - Collection name
  - `description`: string (optional) - Collection description
- **Response**:
  - Status: 200 OK
  - Body: CollectionResponse model
    - `id`: UUID
    - `name`: string
    - `description`: string (optional)
    - `user_id`: UUID
    - `created_at`: datetime
    - `updated_at`: datetime
  - Error Status: 
    - 500 - Failed to create collection
- **Technical Notes**: Creates the logical collection but not the underlying vector store until documents are added.

### List Collections

- **URL**: `/collections`
- **Method**: GET
- **Description**: Lists all collections in the database, ordered by creation date (descending).
- **Implementation Details**:
  - Executes a direct SQL SELECT from collections table
  - Returns array of collection objects with metadata
- **Response**:
  - Status: 200 OK
  - Body: Array of CollectionResponse models
- **Technical Notes**: Only retrieves metadata, not vector store statistics or document counts.

### Get Collection

- **URL**: `/collections/{collection_id}`
- **Method**: GET
- **Description**: Retrieves a specific collection by ID, including all its metadata.
- **Implementation Details**:
  - Executes a direct SQL SELECT from collections table with ID filter
- **Path Parameters**:
  - `collection_id`: string (required) - UUID of collection
- **Response**:
  - Status: 200 OK
  - Body: CollectionResponse model
  - Error Status:
    - 404 - Collection not found
- **Technical Notes**: Only returns collection metadata, not document counts or vector store information.

### Update Collection

- **URL**: `/collections/{collection_id}`
- **Method**: PUT
- **Description**: Replaces an existing collection's metadata while preserving the underlying vector data.
- **Implementation Details**:
  - Checks if collection exists first
  - Executes a direct SQL UPDATE on collections table
  - Sets updated_at timestamp automatically
- **Path Parameters**:
  - `collection_id`: string (required) - UUID of collection
- **Request Body**: 
  - `name`: string (optional) - Updated collection name
  - `description`: string (optional) - Updated collection description
- **Response**:
  - Status: 200 OK
  - Body: CollectionResponse model
  - Error Status:
    - 404 - Collection not found
    - 500 - Failed to update collection
- **Technical Notes**: Only updates metadata, vector collections and document data remain unchanged.

### Partial Update Collection

- **URL**: `/collections/{collection_id}`
- **Method**: PATCH
- **Description**: Updates specific fields of an existing collection without modifying others.
- **Implementation Details**:
  - Similar to PUT but only updates provided fields
  - Uses `exclude_unset=True` in Pydantic model to get only provided fields
- **Path Parameters**:
  - `collection_id`: string (required) - UUID of collection
- **Request Body**: 
  - `name`: string (optional) - Updated collection name
  - `description`: string (optional) - Updated collection description
- **Response**:
  - Status: 200 OK
  - Body: CollectionResponse model
  - Error Status:
    - 404 - Collection not found
    - 500 - Failed to update collection
- **Technical Notes**: Functionally similar to PUT in this implementation; both use `exclude_unset=True` to determine updated fields.

### Delete Collection

- **URL**: `/collections/{collection_id}`
- **Method**: DELETE
- **Description**: Deletes a collection and all its associated document vectors from the database.
- **Implementation Details**:
  - Checks if collection exists first
  - Executes a direct SQL DELETE from collections table
  - Relies on foreign key cascading for document deletion
- **Path Parameters**:
  - `collection_id`: string (required) - UUID of collection
- **Response**:
  - Status: 200 OK
  - Body: `{"success": true}`
  - Error Status:
    - 404 - Collection not found
    - 500 - Failed to delete collection
- **Technical Notes**: May not properly clean up vector store collections in all cases.

## Documents

### Create Document

- **URL**: `/collections/{collection_id}/documents`
- **Method**: POST
- **Description**: Processes and indexes a document file into vector embeddings for semantic search.
- **Implementation Details**:
  - Reads file content based on MIME type (supports PDF, HTML, plaintext, Word)
  - Splits text into chunks using RecursiveCharacterTextSplitter (1000 char chunks, 200 char overlap)
  - Generates OpenAI embeddings for each chunk
  - Stores document chunks with embeddings in PGVector
- **Path Parameters**:
  - `collection_id`: string (required) - UUID of collection
- **Request Body**: 
  - `file`: UploadFile (required) - Document file to be processed
- **Response**:
  - Status: 200 OK
  - Body: 
    ```json
    {
      "success": true,
      "message": "X document chunk(s) added",
      "ids": [array of document IDs]
    }
    ```
  - Error Status:
    - 404 - Collection not found
    - 400 - Failed to process document or document is empty
    - 500 - Error checking collection or failed to add document(s)
- **Technical Notes**: 
  - Uses OpenAIEmbeddings by default (requires API key)
  - Vector dimension depends on embedding model (1536 for ada-002)
  - Limited file type support via MimeTypeBasedParser

### List Documents

- **URL**: `/collections/{collection_id}/documents`
- **Method**: GET
- **Description**: Lists document chunks stored within a specific collection with pagination support.
- **Implementation Details**:
  - Checks if collection exists first
  - Queries PGVector tables for document metadata
- **Path Parameters**:
  - `collection_id`: string (required) - UUID of collection
- **Query Parameters**:
  - `limit`: integer (optional, default: 10, min: 1, max: 100) - Maximum number of documents to return
  - `offset`: integer (optional, default: 0, min: 0) - Pagination offset
- **Response**:
  - Status: 200 OK
  - Body: Array of DocumentResponse models
  - Error Status:
    - 404 - Collection not found
    - 500 - Error checking collection
- **Technical Notes**: Implementation is incomplete in current version, may return empty list.

### Delete Document

- **URL**: `/collections/{collection_id}/documents/{document_id}`
- **Method**: DELETE
- **Description**: Removes a specific document chunk and its vector embeddings from the vector store.
- **Implementation Details**:
  - Checks if collection exists first
  - Initializes PGVector for the collection
  - Calls PGVector's adelete method to remove vectors
- **Path Parameters**:
  - `collection_id`: string (required) - UUID of collection
  - `document_id`: string (required) - UUID of document
- **Response**:
  - Status: 200 OK
  - Body: `{"success": true}`
  - Error Status:
    - 404 - Collection not found
    - 500 - Error checking collection or failed to delete document
- **Technical Notes**: Requires valid UUID from PGVector, performs direct operation on vector store.

### Search Documents

- **URL**: `/collections/{collection_id}/documents/search`
- **Method**: POST
- **Description**: Performs semantic vector similarity search on document chunks using embeddings.
- **Implementation Details**:
  - Generates embedding for query via OpenAI
  - Performs vector similarity search using pgvector's cosine similarity
  - Sorts by score and returns top results
- **Path Parameters**:
  - `collection_id`: string (required) - UUID of collection
- **Request Body**: 
  - `query`: string (required) - Search query text
  - `limit`: integer (optional, default: 10) - Maximum number of results to return
  - `filter`: object (optional) - Filter criteria
- **Response**:
  - Status: 200 OK
  - Body: Array of SearchResult models with similarity scores
  - Error Status:
    - 404 - Collection not found
    - 400 - Search query cannot be empty
    - 500 - Error checking collection
- **Technical Notes**: 
  - Uses same OpenAI embedding model as document processing
  - Relies on pgvector's cosine similarity for semantic matching